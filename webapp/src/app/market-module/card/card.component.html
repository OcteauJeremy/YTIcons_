<div class="cardUI" *ngIf="card" [ngClass]="['card', card.type ? card.type.css : '', 'product'] " data-toggle="modal" [attr.data-target]="'#modal-' + card.id">

  <div class="card-title">
    <h4>{{card.name}}</h4>
  </div>

  <div class="card-img">
    <div class="content-img" *ngIf="card?.image?.indexOf('http') == -1 && card?.image?.indexOf('data:image') == -1" [ngStyle]="{'background-image': 'url(' + cs.baseUrl + card.image + ')'}"></div>
    <div class="content-img" *ngIf="card?.image?.indexOf('http') > -1 || card?.image?.indexOf('data:image') > -1" [ngStyle]="{'background-image': 'url(' + card.image + ')'}"></div>
  </div>

  <!--<div class="product__thumbnail" *ngIf="modal">
    <div class="prod_btn">
      <a data-toggle="modal" [attr.data-target]="'#modal-' + card.id" class="transparent btn--sm btn--round">More Info</a>
      <a *ngIf="card.owner._id != currentUser?._id" data-toggle="modal"  (click)="purchaseCard(card.id, card.price)" class="transparent btn--sm btn--round">Buy</a>
      <a *ngIf="card.owner._id == currentUser?._id" data-toggle="modal" [attr.data-target]="'#modal-' + card.id + '-changePrice'" class="transparent btn--sm btn--round">Change price</a>
    </div>
  </div> -->

  <div class="footer-card">
    <div class="card-line">
      <div>
        <span class="label-footer label-vids">VIDS</span>
        <span class="value-footer">{{card.nbVideos | abbreviateNumber}}</span>
      </div>

      <div>
        <span class="value-footer value-folw">{{card.nbSubscribers | abbreviateNumber}}</span>
        <span class="label-footer">FOLW</span>
      </div>
    </div>
    <div class="card-line">
      <div>
        <span class="label-footer label-view">VIEW</span>
        <span class="value-footer">{{card.nbViews | abbreviateNumber}}</span>
      </div>

      <div>
        <span class="value-footer value-card">{{card.createdAt | timeBetween}}</span>
        <span class="label-footer">CARD</span>
      </div>

    </div>
  </div>
</div>
<div class="product-purchase">
  <div class="price_love">
    <span id="{{'card-price-' + card.id}}">{{card.price | currency}}</span>
  </div>
  <div class="sell"><p><span class="lnr lnr-cart"></span><span>{{card.nbTransactions}}</span></p></div>
</div>

<div class="modal fade rating_modal" id="{{ 'modal-' + card.id}}" tabindex="-1" role="dialog">
<div class="modal-dialog modal-md" role="document">
  <div class="modal-content">
    <div class="modal-header">
      <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
        aria-hidden="true">&times;</span></button>
      <h3 class="modal-title" id="rating_modal">{{card.name}}</h3>
      <p>Own by <a (click)="redirectToUser()" data-dismiss="modal">{{card?.owner?.username == '' ? 'Anonymous' : card?.owner?.username}}</a></p>
    </div>

    <div class="modal-body">
      <div class="col-md-5 col-sm-5 col-xs-12">
        <div [ngClass]="['card', card.type ? card.type.css : '', 'product', 'product--card']">

          <div class="card-title">
            <h4>{{card.name}}</h4>
          </div>

          <div class="card-img">
            <div class="content-img" *ngIf="card?.image?.indexOf('http') > -1 && card?.image?.indexOf('data:image') > -1" [ngStyle]="{'background-image': 'url(' + card.image + ')'}"></div>
            <div class="content-img" *ngIf="card?.image?.indexOf('http') == -1 && card?.image?.indexOf('data:image') == -1" [ngStyle]="{'background-image': 'url(' + cs.baseUrl + card.image + ')'}"></div>
          </div>

          <div class="footer-card">
            <div class="card-line">
              <div>
                <span class="label-footer">VIDS</span>
                <span class="value-footer">{{card.nbVideos | abbreviateNumber}}</span>
              </div>

              <div>
                <span class="value-footer">{{card.nbSubscribers | abbreviateNumber}}</span>
                <span class="label-footer">FOLW</span>
              </div>
            </div>
            <div class="card-line">
              <div>
                <span class="label-footer">VIEW</span>
                <span class="value-footer">{{card.nbViews | abbreviateNumber}}</span>
              </div>

              <div>
                <span class="value-footer">1W</span>
                <span class="label-footer">CARD</span>
              </div>

            </div>
          </div>
        </div>
        <div class="product-purchase">
          <div class="price_love">
            <span>{{card.price | currency}}</span>
          </div>
          <div class="sell"><p><span class="lnr lnr-cart"></span><span>{{card.nbTransactions}}</span></p></div>
        </div>
      </div>
      <div class="col-md-7 col-sm-7 col-xs-12 informations">
        <div class="section">
          <p>Youtube channel</p>
          <span class="ellipsis"><a href="{{card.url}}" target="_blank">{{card.url}}</a></span>
        </div>
        <div class="section">
          <p>Subscribers</p>
          <span>{{card.nbSubscribers}}</span>
        </div>
        <div class="section">
          <p>Nationality</p>
          <span>{{card.nationality?.name}}</span>
        </div>
        <div class="section">
          <p>Description</p>
          <span>{{card.description}}</span>
        </div>
        <div class="section">
          <p>Citation</p>
          <span>{{card.citation}}</span>
        </div>
        <div class="section transactions-container">
          <p>Transactions</p>
          <transactions [transactions]="card.transactions"></transactions>
        </div>
        <div class="section">
          <p>Price history</p>

          <!--<price-chart [card]="card"></price-chart>-->
        </div>


      </div>
    </div><!-- end /.modal-body -->
    <div class="modal-footer">
      <!--<button *ngIf="card?.owner?._id == currentUser?._id"  data-toggle="modal" [attr.data-target]="'#modal-' + card.id + '-changePrice'" class="btn btn&#45;&#45;round btn&#45;&#45;default">Change price</button>-->
      <button  (click)="purchaseCard(card.id, card.price)" class="btn btn--round btn--default">Buy</button>
      <button class="btn btn--round modal_close" data-dismiss="modal">Close</button>
    </div>
  </div>
</div>
</div>


<div class="modal fade" id="{{ 'modal-' + card.id + '-changePrice'}}" tabindex="-1" role="dialog">
  <div class="modal-dialog modal-md" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
          aria-hidden="true">&times;</span></button>
        <h3 class="modal-title" id="">Change Price of {{card.name}}</h3>
      </div>

      <div class="modal-body">
        <div class="col-md-12 col-sm-12 col-xs-12">
          Actual price : {{card.price}} ETH
          <input [(ngModel)]="newPrice" name="newPrice" id="newPrice" type="number" class="text_field"
                 placeholder="Enter new price in ETH" required>
        </div>
      </div><!-- end /.modal-body -->
      <div class="modal-footer">
        <button *ngIf="card?.owner?._id == currentUser?._id" (click)="changePriceCard(card.id)" class="btn btn--round btn--default">Submit</button>
        <button *ngIf="card?.owner?._id != currentUser?._id" (click)="purchaseCard(card.id, card.price)" class="btn btn--round btn--default">Buy</button>
        <button class="btn btn--round modal_close" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>
